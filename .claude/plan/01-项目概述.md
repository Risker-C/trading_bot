# 交易数据可视化项目 - 项目概述

**创建时间**: 2026-01-09
**项目代号**: trading-dashboard
**状态**: 规划阶段

---

## 1. 项目背景

### 1.1 现状分析

**现有系统**：
- 主项目：`trading_bot` - Python 量化交易机器人
- 数据存储：SQLite 数据库（`trading_bot.db`）
- 现有可视化：`scripts/db_viewer.py` - 简单的表格查看器（端口 8888）

**存在问题**：
1. ❌ 无实时数据监控界面
2. ❌ 无法远程访问（仅本地 HTTP 服务）
3. ❌ 缺少图表和可视化分析
4. ❌ 无用户认证和安全机制
5. ❌ 无法部署到云端

### 1.2 项目目标

创建一个**独立的、现代化的交易数据可视化系统**，满足以下需求：

**核心功能**：
1. ✅ 数据实时读取渲染
2. ✅ 当前趋势展示
3. ✅ 生效指标监控
4. ✅ 持仓状态显示
5. ✅ 历史记录查询
6. ✅ AI 交互功能

**技术目标**：
- 前后端分离架构
- 支持云端部署（Vercel）
- 实时数据推送
- 现代化 UI/UX
- 安全认证机制

---

## 2. 技术栈选型

### 2.1 前端技术栈

| 技术 | 版本 | 用途 |
|------|------|------|
| **Next.js** | 14+ | React 框架（App Router） |
| **shadcn/ui** | latest | UI 组件库（基于 Radix UI） |
| **Tailwind CSS** | 3.x | CSS 框架 |
| **Recharts** | 2.x | 图表库 |
| **TanStack Query** | 5.x | 数据获取和缓存 |
| **Zustand** | 4.x | 状态管理 |
| **TypeScript** | 5.x | 类型安全 |

### 2.2 后端技术栈

| 技术 | 版本 | 用途 |
|------|------|------|
| **FastAPI** | 0.109+ | Python Web 框架 |
| **SQLite** | 3.x | 数据库（WAL 模式） |
| **WebSocket** | - | 实时数据推送 |
| **JWT** | - | 用户认证 |
| **Uvicorn** | latest | ASGI 服务器 |

### 2.3 部署方案

| 组件 | 部署位置 | 说明 |
|------|---------|------|
| **Frontend** | Vercel | 静态部署，全球 CDN |
| **Backend API** | 本地/VPS | 需要访问本地 SQLite |
| **数据库** | 本地 | 与 trading_bot 共享 |

---

## 3. 项目结构

### 3.1 目录结构

```
trading_bot/                    # 主项目根目录
├── [现有 Python 代码]
├── trading_bot.db              # SQLite 数据库
│
├── apps/                       # 新增：子项目目录
│   ├── api/                    # 后端 API 服务
│   │   ├── main.py            # FastAPI 入口
│   │   ├── routes/            # API 路由
│   │   │   ├── trades.py      # 交易记录接口
│   │   │   ├── positions.py   # 持仓接口
│   │   │   ├── trends.py      # 趋势接口
│   │   │   ├── indicators.py  # 指标接口
│   │   │   ├── history.py     # 历史记录接口
│   │   │   └── ai.py          # AI 交互接口
│   │   ├── models/            # 数据模型
│   │   ├── services/          # 业务逻辑
│   │   ├── auth.py            # 认证模块
│   │   ├── websocket.py       # WebSocket 处理
│   │   └── requirements.txt   # Python 依赖
│   │
│   └── dashboard/             # 前端 Dashboard
│       ├── app/               # Next.js App Router
│       │   ├── layout.tsx     # 根布局
│       │   ├── page.tsx       # 首页
│       │   ├── api/           # Next.js API Routes（可选）
│       │   └── (dashboard)/   # Dashboard 页面组
│       ├── components/        # React 组件
│       │   ├── ui/            # shadcn/ui 组件
│       │   ├── charts/        # 图表组件
│       │   ├── tables/        # 表格组件
│       │   └── ai-chat/       # AI 聊天组件
│       ├── lib/               # 工具函数
│       │   ├── api-client.ts  # API 客户端
│       │   ├── websocket.ts   # WebSocket 客户端
│       │   └── utils.ts       # 通用工具
│       ├── hooks/             # 自定义 Hooks
│       ├── types/             # TypeScript 类型
│       ├── package.json
│       ├── tsconfig.json
│       └── next.config.js
│
└── .claude/
    └── plan/                  # 本规划文档目录
        ├── 01-项目概述.md
        ├── 02-技术方案.md
        ├── 03-后端API设计.md
        ├── 04-前端Dashboard设计.md
        ├── 05-实施计划.md
        └── 06-TodoList.md
```

### 3.2 数据流架构

```
┌─────────────────────────────────────────────────────────┐
│                    用户浏览器                            │
│  ┌─────────────────────────────────────────────────┐   │
│  │         Next.js Dashboard (Vercel)              │   │
│  │  - React 组件                                    │   │
│  │  - shadcn/ui                                     │   │
│  │  - TanStack Query (数据缓存)                    │   │
│  └──────────────┬──────────────────────────────────┘   │
└─────────────────┼──────────────────────────────────────┘
                  │ HTTPS / WebSocket
                  │
┌─────────────────▼──────────────────────────────────────┐
│              FastAPI Backend (本地/VPS)                │
│  ┌─────────────────────────────────────────────────┐  │
│  │  - REST API 端点                                 │  │
│  │  - WebSocket 实时推送                            │  │
│  │  - JWT 认证                                      │  │
│  │  - 业务逻辑层                                    │  │
│  └──────────────┬──────────────────────────────────┘  │
└─────────────────┼──────────────────────────────────────┘
                  │ SQLite 查询
                  │
┌─────────────────▼──────────────────────────────────────┐
│           SQLite Database (本地)                       │
│  ┌─────────────────────────────────────────────────┐  │
│  │  - trades (交易记录)                             │  │
│  │  - trade_tags (决策链)                           │  │
│  │  - position_snapshots (持仓快照)                 │  │
│  │  - arbitrage_trades (套利记录)                   │  │
│  │  - shadow_decisions (影子决策)                   │  │
│  └─────────────────────────────────────────────────┘  │
│                                                         │
│  ┌─────────────────────────────────────────────────┐  │
│  │         trading_bot (Python)                     │  │
│  │  - 持续写入交易数据                              │  │
│  │  - 与 API 共享数据库                             │  │
│  └─────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────┘
```

---

## 4. 核心特性

### 4.1 实时数据监控

- **WebSocket 连接**：建立持久连接，推送实时数据
- **自动重连**：网络断开时自动重连
- **心跳检测**：保持连接活跃
- **增量更新**：只推送变化的数据

### 4.2 数据可视化

- **趋势图表**：价格走势、技术指标
- **持仓卡片**：当前持仓、浮动盈亏
- **指标面板**：生效的交易指标
- **历史表格**：可筛选、可排序的交易记录

### 4.3 AI 交互

- **聊天界面**：与 Claude 进行对话
- **市场分析**：请求 AI 分析当前市场
- **策略建议**：获取交易策略建议
- **历史回顾**：分析历史交易表现

### 4.4 安全性

- **JWT 认证**：基于 Token 的用户认证
- **API 密钥保护**：Claude API 密钥仅在后端
- **CORS 配置**：限制跨域访问
- **速率限制**：防止 API 滥用

---

## 5. 成功标准

### 5.1 功能完整性

- ✅ 6 个核心功能模块全部实现
- ✅ 实时数据更新延迟 < 5 秒
- ✅ 历史数据查询响应 < 1 秒
- ✅ AI 交互响应 < 10 秒

### 5.2 用户体验

- ✅ 页面加载时间 < 3 秒
- ✅ 响应式设计（支持桌面和移动端）
- ✅ 无明显 UI 卡顿
- ✅ 清晰的错误提示

### 5.3 可维护性

- ✅ 代码结构清晰，模块化
- ✅ TypeScript 类型覆盖率 > 90%
- ✅ 关键功能有单元测试
- ✅ API 文档完整（OpenAPI/Swagger）

---

## 6. 风险评估

### 6.1 技术风险

| 风险 | 影响 | 缓解措施 |
|------|------|---------|
| SQLite 并发读写冲突 | 高 | 启用 WAL 模式，设置 busy_timeout |
| WebSocket 连接不稳定 | 中 | 实现自动重连和心跳检测 |
| API 性能瓶颈 | 中 | 添加缓存层，优化查询 |
| Vercel 部署限制 | 低 | 前端静态部署，无服务器限制 |

### 6.2 业务风险

| 风险 | 影响 | 缓解措施 |
|------|------|---------|
| 影响交易系统性能 | 高 | API 只读访问，不修改数据 |
| 数据安全泄露 | 高 | JWT 认证，HTTPS 加密 |
| Claude API 成本 | 中 | 实现缓存，限制调用频率 |

---

## 7. 下一步

1. ✅ 阅读 `02-技术方案.md` - 详细技术方案设计
2. ✅ 阅读 `03-后端API设计.md` - FastAPI 接口设计
3. ✅ 阅读 `04-前端Dashboard设计.md` - Next.js 组件设计
4. ✅ 阅读 `05-实施计划.md` - 分阶段实施步骤
5. ✅ 阅读 `06-TodoList.md` - 详细任务清单

---

**文档版本**: v1.0
**最后更新**: 2026-01-09
